<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>物联网操作系统AliOS Things 3.3: cli</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">物联网操作系统AliOS Things 3.3
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.9.1 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('cli.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">cli </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md355"></a>
概述</h1>
<p>在日常嵌入式开发中，用户经常会自行实现一套类似Linux Shell的交互工具来实现通过串口命令控制设备进入某种特定的状态，或执行某个特定的操作。如系统自检，模拟运行，或者进入手动模式进行设备点动。AliOS Things原生实现了一套名为CLI（Command-Line Interface）的命令行交互工具，在提供基本的系统交互命令的基础上，也支持用户自定义命令。 组件支持以下功能：</p><ul>
<li>cli commands register</li>
<li>cli commands unregister</li>
<li>cli commands show </li>
</ul>
<h2><a class="anchor" id="autotoc_md356"></a>
版权信息</h2>
<blockquote class="doxtable">
<p>Apache license v2.0 </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md357"></a>
目录结构</h2>
<div class="fragment"><div class="line">├── include</div>
<div class="line">│   └── aos</div>
<div class="line">│       └── cli.h        # cli的对外AOS API</div>
<div class="line">├── package.yaml         # 编译配置文件</div>
<div class="line">├── README.md</div>
<div class="line">└── src</div>
<div class="line">    ├── cli_adapt.c      # cli适配层</div>
<div class="line">    ├── cli_adapt.h</div>
<div class="line">    ├── cli_aos.c        # cli-aos接口层</div>
<div class="line">    ├── cli_api.h</div>
<div class="line">    ├── cli.c            # cli核心管理</div>
<div class="line">    ├── cli_console.c    # cli console管理</div>
<div class="line">    ├── cli_console.h</div>
<div class="line">    ├── telnet_console.c # cli使用telnet输入输出（可选方式）</div>
<div class="line">    ├── uart_console.c   # cli使用Uart输入输出（默认方式）</div>
<div class="line">    ├── iobox            # 文件系统操作命令集</div>
<div class="line">    │   ├── cat.c</div>
<div class="line">    │   ├── cd.c</div>
<div class="line">    │   ├── cp.c</div>
<div class="line">    │   ├── df.c</div>
<div class="line">    │   ├── echo.c</div>
<div class="line">    │   ├── hexdump.c</div>
<div class="line">    │   ├── ls.c</div>
<div class="line">    │   ├── lsfs.c</div>
<div class="line">    │   ├── mkdir.c</div>
<div class="line">    │   ├── mv.c</div>
<div class="line">    │   ├── path_helper.c</div>
<div class="line">    │   ├── path_helper.h</div>
<div class="line">    │   ├── pwd.c</div>
<div class="line">    │   ├── rm.c</div>
<div class="line">    │   └── touch.c</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md358"></a>
依赖组件</h2>
<ul>
<li>rhino</li>
<li>driver</li>
<li>vfs(使用文件系统操作命令)</li>
<li>littlefs(使用文件系统操作命令)</li>
</ul>
<h1><a class="anchor" id="autotoc_md359"></a>
常用配置</h1>
<p>系统中相关配置已有默认值，如需修改配置，统一在yaml中**def_config**节点修改，具体如下： </p><blockquote class="doxtable">
<p>cli 输入缓冲区大小: 默认256 bytes，即cli单次可接收的输入最大字节数，可修改yaml配置如： </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_INBUF_SIZE: 256</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>cli 输出缓冲区大小: 默认512 bytes，即cli命令中单个printf输出的最大字节数，可修改yaml配置如： </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_OUTBUF_SIZE: 512</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>可注册的cli命令最大值，默认128个命令（通过help命令查看），可修改yaml配置如： </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_MAX_COMMANDS: 128</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>单个cli命令可带参数的最大值，默认16个参数，可修改yaml配置如： </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_MAX_ARG_NUM: 16</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>可连续执行的cli命令数量（命令中间用分号；间隔），默认4个，可修改yaml配置如： </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_MAX_ONCECMD_NUM: 4</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>cli后台任务的优先级，默认为60，可修改yaml配置如： </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_TASK_PRIORITY: 60</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>cli后台任务的栈大小，默认为2KB（2048Bytes），可修改yaml配置如： </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_CONFIG_STACK_SIZE: 2048</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>cli使用telnet接管输入输出，此功能默认不开，可修改yaml配置如： </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_TELNET_SUPPORT: 0</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>cli输出增加不可见字符，用于SmartTrace工具中，此功能默认关闭，可修改yaml配置如： </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_SEPRATED_CONSOLE: 0</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>cli使能文件系统操作命令，此功能默认不开，可修改yaml配置如： </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_IOBOX_ENABLE: 0</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md360"></a>
API说明</h1>
<p><a class="el" href="group__cli__aos__api.html">cli</a></p>
<h1><a class="anchor" id="autotoc_md361"></a>
使用示例</h1>
<h2><a class="anchor" id="autotoc_md362"></a>
示例代码</h2>
<p>Example: 包含头文件 **#include "aos/cli.h"**</p>
<blockquote class="doxtable">
<p>注册命令方式1：注册单个cli命令 </p>
</blockquote>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="keywordtype">void</span> test_cmd(<span class="keywordtype">char</span> *buf, int32_t len, int32_t argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* test_cmd 命令实现 */</span></div>
<div class="line">    <a class="code" href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a>(<span class="stringliteral">&quot;this is test cmd\r\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structcli__command.html">cli_command</a> cmd = {<span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;test cmd description&quot;</span>, test_cmd};</div>
<div class="line"> </div>
<div class="line">ret = <a class="code" href="group__cli__aos__api.html#ga0bedf67ee7ec64305141156e82619704">aos_cli_register_command</a>(&amp;cmd);</div>
<div class="line"><span class="keywordflow">if</span> (ret) {</div>
<div class="line">  <span class="comment">/* 错误处理 */</span></div>
<div class="line">  <a class="code" href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a>(<span class="stringliteral">&quot;test cmd register fail\r\n&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__cli__aos__api_html_ga0bedf67ee7ec64305141156e82619704"><div class="ttname"><a href="group__cli__aos__api.html#ga0bedf67ee7ec64305141156e82619704">aos_cli_register_command</a></div><div class="ttdeci">int aos_cli_register_command(const struct cli_command *cmd)</div><div class="ttdoc">This function register a command with the command-line interface</div></div>
<div class="ttc" id="agroup__cli__aos__api_html_gab4dfa506ecc735e58cff8a009093e066"><div class="ttname"><a href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a></div><div class="ttdeci">int aos_cli_printf(const char *fmt,...)</div><div class="ttdoc">use aos_cli_printf instead of printf in cli cmd</div></div>
<div class="ttc" id="astructcli__command_html"><div class="ttname"><a href="structcli__command.html">cli_command</a></div><div class="ttdef"><b>Definition:</b> <a href="cli_8h_source.html#l00020">cli.h:21</a></div></div>
</div><!-- fragment --><blockquote class="doxtable">
<p>注册命令方式2：同时注册多个cli命令 </p>
</blockquote>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="keywordtype">void</span> test1_cmd(<span class="keywordtype">char</span> *buf, int32_t len, int32_t argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* test_cmd 命令实现 */</span></div>
<div class="line">    <a class="code" href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a>(<span class="stringliteral">&quot;this is test cmd1\r\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> test2_cmd(<span class="keywordtype">char</span> *buf, int32_t len, int32_t argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* test_cmd 命令实现 */</span></div>
<div class="line">    <a class="code" href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a>(<span class="stringliteral">&quot;this is test cmd2\r\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structcli__command.html">cli_command</a> cmds[] = {</div>
<div class="line">     { <span class="stringliteral">&quot;test1&quot;</span>, <span class="stringliteral">&quot;show test1 info&quot;</span>, test1_cmd },</div>
<div class="line">     { <span class="stringliteral">&quot;test2&quot;</span>, <span class="stringliteral">&quot;show test2 info&quot;</span>, test2_cmd },</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">ret = <a class="code" href="group__cli__aos__api.html#gacc57dec2af4a010ed1a59fc10734aeb7">aos_cli_register_commands</a>(&amp;cmds, <span class="keyword">sizeof</span>(cmds) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structcli__command.html">cli_command</a>));</div>
<div class="line"><span class="keywordflow">if</span> (ret) {</div>
<div class="line">    <span class="comment">/* 错误处理 */</span></div>
<div class="line">    <a class="code" href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a>(<span class="stringliteral">&quot;test cmds register fail\r\n&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__cli__aos__api_html_gacc57dec2af4a010ed1a59fc10734aeb7"><div class="ttname"><a href="group__cli__aos__api.html#gacc57dec2af4a010ed1a59fc10734aeb7">aos_cli_register_commands</a></div><div class="ttdeci">int aos_cli_register_commands(const struct cli_command *cmds, int num)</div><div class="ttdoc">This function register multi CLI commands</div></div>
</div><!-- fragment --><blockquote class="doxtable">
<p>注册命令方式3：通过宏注册单个cli命令 注意：这种方式不需要判断返回值，若注册失败，系统在初始化过程中会输出相应信息 </p>
</blockquote>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> test_cmd3(int32_t argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* test_cmd3 命令实现 */</span></div>
<div class="line">    <a class="code" href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a>(<span class="stringliteral">&quot;this is test cmd3\r\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* 宏的参数说明：</span></div>
<div class="line"><span class="comment"> * 参数1. cmd具体实现</span></div>
<div class="line"><span class="comment"> * 参数2. 在串口下输入的命令</span></div>
<div class="line"><span class="comment"> * 参数3. cmd的描述信息</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><a class="code" href="group__cli__aos__api.html#ga9b313b8e90fe34d85db65c3ba8f4d8f0">ALIOS_CLI_CMD_REGISTER</a>(test_cmd3, test3, show test3 info)</div>
<div class="ttc" id="agroup__cli__aos__api_html_ga9b313b8e90fe34d85db65c3ba8f4d8f0"><div class="ttname"><a href="group__cli__aos__api.html#ga9b313b8e90fe34d85db65c3ba8f4d8f0">ALIOS_CLI_CMD_REGISTER</a></div><div class="ttdeci">#define ALIOS_CLI_CMD_REGISTER(name, cmd, desc)</div><div class="ttdef"><b>Definition:</b> <a href="cli_8h_source.html#l00040">cli.h:40</a></div></div>
</div><!-- fragment --><blockquote class="doxtable">
<p>开发环境的搭建请参考 HaaS100_Quick_Start (搭建开发环境章节)，其中详细的介绍了AliOS Things 3.3的IDE集成开发环境的搭建流程。 </p>
</blockquote>
<p>## app中添加cli组件 </p><blockquote class="doxtable">
<p>以运行helloworld_demo为例，具体步骤如下： 在helloworld_demo组件的package.yaml中添加 </p>
</blockquote>
<div class="fragment"><div class="line">depends:</div>
<div class="line">  - cli: dev_aos # helloworld_demo中引入cli组件</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md363"></a>
编译烧录</h2>
<p>&gt;参考 HaaS100_Quick_Start</p>
<h2><a class="anchor" id="autotoc_md364"></a>
CLI示例测试</h2>
<blockquote class="doxtable">
<p>命令行输入： </p>
</blockquote>
<div class="fragment"><div class="line">help</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md365"></a>
关键日志</h2>
<blockquote class="doxtable">
<p>CLI日志： </p>
</blockquote>
<div class="fragment"><div class="line">================ AliOS Things Command List ==============</div>
<div class="line">help</div>
<div class="line">...(注册的cli命令)</div>
<div class="line">================ AliOS Things Command End ===============</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md366"></a>
FAQ</h1>
<p>Q1： 如何打开文件系统操作命令集？ </p><div class="fragment"><div class="line">答：</div>
<div class="line">cli组件支持文件系统操作命令，默认关闭，打开方式为：</div>
<div class="line">以运行helloworld_demo为例，在其package.yaml中添加</div>
<div class="line"> </div>
<div class="line">def_config:</div>
<div class="line">    CLI_IOBOX_ENABLE: 1</div>
<div class="line"> </div>
<div class="line">然后重新编译烧录，上电后输入help，即可看到</div>
<div class="line">ls</div>
<div class="line">ll</div>
<div class="line">mkdir</div>
<div class="line">cat</div>
<div class="line">df</div>
<div class="line">touch</div>
<div class="line">...</div>
<div class="line">等文件系统命令</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">生成于 2021年 四月 15日 星期四 18:02:37 , 为 物联网操作系统AliOS Things 3.3使用  <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
