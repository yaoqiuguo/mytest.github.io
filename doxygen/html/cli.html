<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>物联网操作系统AliOS Things 3.3: cli</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">物联网操作系统AliOS Things 3.3
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.9.1 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('cli.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">cli </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://gitee.com/alios-things/cli/edit/master/README.md">更正文档</a> &emsp;&emsp;&emsp;&emsp; <a href="https://g.alicdn.com/alios-things-3.3/doc/contribute_doc.html">贡献说明</a></p>
<h1><a class="anchor" id="autotoc_md385"></a>
概述</h1>
<p>在日常嵌入式开发中，用户经常会自行实现一套类似Linux Shell的交互工具来实现通过串口命令控制设备进入某种特定的状态，或执行某个特定的操作。如系统自检，模拟运行，或者进入手动模式进行设备点动。AliOS Things原生实现了一套名为CLI（Command-Line Interface）的命令行交互工具，在提供基本的系统交互命令的基础上，也支持用户自定义命令。 组件支持以下功能：</p><ul>
<li>cli commands register</li>
<li>cli commands unregister</li>
<li>cli commands show</li>
<li>fs cmds support </li>
</ul>
<h2><a class="anchor" id="autotoc_md386"></a>
版权信息</h2>
<blockquote class="doxtable">
<p>Apache license v2.0 </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md387"></a>
目录结构</h2>
<div class="fragment"><div class="line">├── include</div>
<div class="line">│   └── aos</div>
<div class="line">│       └── cli.h        # cli的对外AOS API</div>
<div class="line">├── package.yaml         # 编译配置文件</div>
<div class="line">├── README.md</div>
<div class="line">└── src</div>
<div class="line">    ├── cli_adapt.c      # cli适配层</div>
<div class="line">    ├── cli_adapt.h</div>
<div class="line">    ├── cli_aos.c        # cli-aos接口层</div>
<div class="line">    ├── cli_api.h</div>
<div class="line">    ├── cli.c            # cli核心管理</div>
<div class="line">    ├── cli_console.c    # cli console管理</div>
<div class="line">    ├── cli_console.h</div>
<div class="line">    ├── uart_console.c   # cli使用Uart串口输入输出（默认方式）</div>
<div class="line">    ├── telnet_console.c # cli使用telnet局域网输入输出（可选方式）</div>
<div class="line">    ├── cli_uagent.c     # cli使用远程调试终端输入输出（可选方式）</div>
<div class="line">    ├── iobox            # 文件系统操作命令集</div>
<div class="line">    │   ├── cat.c</div>
<div class="line">    │   ├── cd.c</div>
<div class="line">    │   ├── cp.c</div>
<div class="line">    │   ├── df.c</div>
<div class="line">    │   ├── echo.c</div>
<div class="line">    │   ├── hexdump.c</div>
<div class="line">    │   ├── ls.c</div>
<div class="line">    │   ├── lsfs.c</div>
<div class="line">    │   ├── mkdir.c</div>
<div class="line">    │   ├── mv.c</div>
<div class="line">    │   ├── path_helper.c</div>
<div class="line">    │   ├── path_helper.h</div>
<div class="line">    │   ├── pwd.c</div>
<div class="line">    │   ├── rm.c</div>
<div class="line">    │   └── touch.c</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md388"></a>
依赖组件</h2>
<ul>
<li>rhino</li>
<li>driver</li>
<li>vfs(使用文件系统操作命令)</li>
<li>littlefs(使用文件系统操作命令)</li>
</ul>
<h1><a class="anchor" id="autotoc_md389"></a>
常用配置</h1>
<p>系统中相关配置已有默认值，如需修改配置，在相应app下的package.yaml中**def_config**节点修改。例如：若运行的app为helloworld_demo，则在helloworld_demo下的package.yaml中修改： </p><blockquote class="doxtable">
<p>cli 输入缓冲区大小: 默认256 bytes，即cli单次可接收的输入最大字节数 </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_INBUF_SIZE: 256</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>cli 输出缓冲区大小: 默认512 bytes，即cli命令中单个printf输出的最大字节数 </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_OUTBUF_SIZE: 512</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>可注册的cli命令最大值，默认最多可注册128个命令（通过help命令查看） </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_MAX_COMMANDS: 128</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>单个cli命令可带参数的最大值，默认最多可带16个参数 </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_MAX_ARG_NUM: 16</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>可连续执行的cli命令数量（命令中间用分号；间隔），默认为4个 </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_MAX_ONCECMD_NUM: 4</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>cli后台任务的优先级，默认为60 </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_TASK_PRIORITY: 60</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>cli后台任务的栈大小，默认为2KB(2048Bytes) </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_CONFIG_STACK_SIZE: 2048</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>cli使用telnet接管输入输出，此功能默认不开 </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_TELNET_ENABLE: 0</div>
</div><!-- fragment --> <blockquote class="doxtable">
<p>cli使用uagent接管输入输出，即cli日志输入输出在远程诊断终端上，此功能默认不开 </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_UAGENT_ENABLE: 0</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>cli输出增加不可见字符，用于SmartTrace工具中，此功能默认关闭 </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_SEPRATED_CONSOLE: 0</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>cli使能文件系统操作命令，此功能默认不开 </p>
</blockquote>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_IOBOX_ENABLE: 0</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md390"></a>
API说明</h1>
<ul>
<li>参考 <a href="https://dev.g.alicdn.com/alios-things-3.3/doc/group__cli__aos__api.html">cli_aos_api</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md391"></a>
使用示例</h1>
<p>组件使用示例相关的代码下载、编译和固件烧录均依赖AliOS Things配套的开发工具 <b>alios-studio</b> ，所以首先需要参考<a href="https://g.alicdn.com/alios-things-3.3/doc/setup_env.html">《aos-studio使用说明之搭建开发环境》</a>，下载安装 <b>alios-studio</b> 。 待开发环境搭建完成后，可以按照以下步骤进行示例的测试。</p>
<h2><a class="anchor" id="autotoc_md392"></a>
步骤1 创建或打开工程</h2>
<p><b>打开已有工程</b></p>
<p>如果用于测试的案例工程已存在，可参考<a href="https://g.alicdn.com/alios-things-3.3/doc/open_project.html">《aos-studio使用说明之打开工程》</a>打开已有工程。</p>
<p><b>创建新的工程</b></p>
<p>组件的示例代码可以通过编译链接到AliOS Things的任意案例（solution）来运行，这里选择helloworld_demo案例。helloworld_demo案例相关的源代码下载可参考<a href="https://g.alicdn.com/alios-things-3.3/doc/create_project.html">《aos-studio使用说明之创建工程》</a>。</p>
<h2><a class="anchor" id="autotoc_md393"></a>
步骤2 添加组件</h2>
<p>案例下载完成后，以运行helloworld_demo为例，需要在helloworld_demo组件的package.yaml中添加对组件的依赖：</p>
<div class="fragment"><div class="line">depends:</div>
<div class="line">  - cli: master  # helloworld_demo中引入cli组件</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md394"></a>
步骤3 下载组件</h2>
<p>在已安装了 <b>alios-studio</b> 的开发环境工具栏中，选择Terminal -&gt; New Terminal启动终端，并且默认工作路径为当前工程的workspace，此时在终端命令行中输入：</p>
<div class="fragment"><div class="line">aos install cli</div>
</div><!-- fragment --><p>上述命令执行成功后，组件源码则被下载到了./components/cli路径中。</p>
<h2><a class="anchor" id="autotoc_md395"></a>
步骤4 添加示例</h2>
<p>下面示例演示了注册cli命令的三种方式，分别是：</p><ol type="1">
<li>注册单个cli命令</li>
<li>同时注册对个cli命令</li>
<li>通过宏注册单个cli命令</li>
</ol>
<p>Example: 包含头文件 **#include "aos/cli.h"**</p>
<blockquote class="doxtable">
<p>注册命令方式1：注册单个cli命令 </p>
</blockquote>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="keywordtype">void</span> test_cmd(<span class="keywordtype">char</span> *buf, int32_t len, int32_t argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* test_cmd 命令实现 */</span></div>
<div class="line">    <a class="code" href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a>(<span class="stringliteral">&quot;this is test cmd\r\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structcli__command.html">cli_command</a> cmd = {<span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;test cmd description&quot;</span>, test_cmd};</div>
<div class="line"> </div>
<div class="line">ret = <a class="code" href="group__cli__aos__api.html#ga0bedf67ee7ec64305141156e82619704">aos_cli_register_command</a>(&amp;cmd);</div>
<div class="line"><span class="keywordflow">if</span> (ret) {</div>
<div class="line">  <span class="comment">/* 错误处理 */</span></div>
<div class="line">  <a class="code" href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a>(<span class="stringliteral">&quot;test cmd register fail\r\n&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__cli__aos__api_html_ga0bedf67ee7ec64305141156e82619704"><div class="ttname"><a href="group__cli__aos__api.html#ga0bedf67ee7ec64305141156e82619704">aos_cli_register_command</a></div><div class="ttdeci">int aos_cli_register_command(const struct cli_command *cmd)</div><div class="ttdoc">This function register a command with the command-line interface</div></div>
<div class="ttc" id="agroup__cli__aos__api_html_gab4dfa506ecc735e58cff8a009093e066"><div class="ttname"><a href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a></div><div class="ttdeci">int aos_cli_printf(const char *fmt,...)</div><div class="ttdoc">use aos_cli_printf instead of printf in cli cmd</div></div>
<div class="ttc" id="astructcli__command_html"><div class="ttname"><a href="structcli__command.html">cli_command</a></div><div class="ttdef"><b>Definition:</b> <a href="cli_8h_source.html#l00020">cli.h:21</a></div></div>
</div><!-- fragment --><blockquote class="doxtable">
<p>注册命令方式2：同时注册多个cli命令 </p>
</blockquote>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="keywordtype">void</span> test1_cmd(<span class="keywordtype">char</span> *buf, int32_t len, int32_t argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* test_cmd 命令实现 */</span></div>
<div class="line">    <a class="code" href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a>(<span class="stringliteral">&quot;this is test cmd1\r\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> test2_cmd(<span class="keywordtype">char</span> *buf, int32_t len, int32_t argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* test_cmd 命令实现 */</span></div>
<div class="line">    <a class="code" href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a>(<span class="stringliteral">&quot;this is test cmd2\r\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structcli__command.html">cli_command</a> cmds[] = {</div>
<div class="line">     { <span class="stringliteral">&quot;test1&quot;</span>, <span class="stringliteral">&quot;show test1 info&quot;</span>, test1_cmd },</div>
<div class="line">     { <span class="stringliteral">&quot;test2&quot;</span>, <span class="stringliteral">&quot;show test2 info&quot;</span>, test2_cmd },</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">ret = <a class="code" href="group__cli__aos__api.html#gacc57dec2af4a010ed1a59fc10734aeb7">aos_cli_register_commands</a>(&amp;cmds, <span class="keyword">sizeof</span>(cmds) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structcli__command.html">cli_command</a>));</div>
<div class="line"><span class="keywordflow">if</span> (ret) {</div>
<div class="line">    <span class="comment">/* 错误处理 */</span></div>
<div class="line">    <a class="code" href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a>(<span class="stringliteral">&quot;test cmds register fail\r\n&quot;</span>);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__cli__aos__api_html_gacc57dec2af4a010ed1a59fc10734aeb7"><div class="ttname"><a href="group__cli__aos__api.html#gacc57dec2af4a010ed1a59fc10734aeb7">aos_cli_register_commands</a></div><div class="ttdeci">int aos_cli_register_commands(const struct cli_command *cmds, int num)</div><div class="ttdoc">This function register multi CLI commands</div></div>
</div><!-- fragment --><blockquote class="doxtable">
<p>注册命令方式3：通过宏注册单个cli命令 注意：这种方式不需要判断返回值，若注册失败，系统在初始化过程中会输出相应信息 </p>
</blockquote>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> test_cmd3(int32_t argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* test_cmd3 命令实现 */</span></div>
<div class="line">    <a class="code" href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a>(<span class="stringliteral">&quot;this is test cmd3\r\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* 宏的参数说明：</span></div>
<div class="line"><span class="comment"> * 参数1. cmd具体实现</span></div>
<div class="line"><span class="comment"> * 参数2. 在串口下输入的命令</span></div>
<div class="line"><span class="comment"> * 参数3. cmd的描述信息</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><a class="code" href="group__cli__aos__api.html#ga9b313b8e90fe34d85db65c3ba8f4d8f0">ALIOS_CLI_CMD_REGISTER</a>(test_cmd3, test3, show test3 info)</div>
<div class="ttc" id="agroup__cli__aos__api_html_ga9b313b8e90fe34d85db65c3ba8f4d8f0"><div class="ttname"><a href="group__cli__aos__api.html#ga9b313b8e90fe34d85db65c3ba8f4d8f0">ALIOS_CLI_CMD_REGISTER</a></div><div class="ttdeci">#define ALIOS_CLI_CMD_REGISTER(name, cmd, desc)</div><div class="ttdef"><b>Definition:</b> <a href="cli_8h_source.html#l00040">cli.h:40</a></div></div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md396"></a>
代码示例</h3>
<p>helloworld_demo注册cli命令，修改helloworld.c如下： </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="init_8h.html">aos/init.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;board.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;aos/errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="kernel_8h.html">aos/kernel.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;k_api.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="cli_8h.html">aos/cli.h</a>&quot;</span> <span class="comment">/* 加上头文件 */</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> test_cmd(<span class="keywordtype">char</span> *buf, int32_t len, int32_t argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* test_cmd 命令实现 */</span></div>
<div class="line">    <a class="code" href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a>(<span class="stringliteral">&quot;this is test cmd\r\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> test1_cmd(<span class="keywordtype">char</span> *buf, int32_t len, int32_t argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* test_cmd 命令实现 */</span></div>
<div class="line">    <a class="code" href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a>(<span class="stringliteral">&quot;this is test cmd1\r\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> test2_cmd(<span class="keywordtype">char</span> *buf, int32_t len, int32_t argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* test_cmd 命令实现 */</span></div>
<div class="line">    <a class="code" href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a>(<span class="stringliteral">&quot;this is test cmd2\r\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structcli__command.html">cli_command</a> cmd = {<span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;test cmd description&quot;</span>, test_cmd};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structcli__command.html">cli_command</a> cmds[] = {</div>
<div class="line">     { <span class="stringliteral">&quot;test1&quot;</span>, <span class="stringliteral">&quot;show test1 info&quot;</span>, test1_cmd },</div>
<div class="line">     { <span class="stringliteral">&quot;test2&quot;</span>, <span class="stringliteral">&quot;show test2 info&quot;</span>, test2_cmd },</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="group__init__aos__api.html#ga55ef20a4d055aed8a8b3b25a90f8aee4">application_start</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> count = 0;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">    printf(<span class="stringliteral">&quot;nano entry here!\r\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    ret = <a class="code" href="group__cli__aos__api.html#ga0bedf67ee7ec64305141156e82619704">aos_cli_register_command</a>(&amp;cmd);</div>
<div class="line">    <span class="keywordflow">if</span> (ret) {</div>
<div class="line">      <span class="comment">/* 错误处理 */</span></div>
<div class="line">      <a class="code" href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a>(<span class="stringliteral">&quot;test cmd register fail\r\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ret = <a class="code" href="group__cli__aos__api.html#gacc57dec2af4a010ed1a59fc10734aeb7">aos_cli_register_commands</a>(&amp;cmds, <span class="keyword">sizeof</span>(cmds) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structcli__command.html">cli_command</a>));</div>
<div class="line">    <span class="keywordflow">if</span> (ret) {</div>
<div class="line">        <span class="comment">/* 错误处理 */</span></div>
<div class="line">        <a class="code" href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a>(<span class="stringliteral">&quot;test cmds register fail\r\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">        <span class="comment">//printf(&quot;hello world! count %d \r\n&quot;, count++);</span></div>
<div class="line">        <a class="code" href="group__aos__kernel__time.html#ga198267174bf34247bca2163293c20d5c">aos_msleep</a>(1000);</div>
<div class="line">    };</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> test_cmd3(int32_t argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* test_cmd3 命令实现 */</span></div>
<div class="line">    <a class="code" href="group__cli__aos__api.html#gab4dfa506ecc735e58cff8a009093e066">aos_cli_printf</a>(<span class="stringliteral">&quot;this is test cmd3\r\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* 宏的参数说明：</span></div>
<div class="line"><span class="comment"> * 参数1. cmd具体实现</span></div>
<div class="line"><span class="comment"> * 参数2. 在串口下输入的命令</span></div>
<div class="line"><span class="comment"> * 参数3. cmd的描述信息</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><a class="code" href="group__cli__aos__api.html#ga9b313b8e90fe34d85db65c3ba8f4d8f0">ALIOS_CLI_CMD_REGISTER</a>(test_cmd3, test3, show test3 info)</div>
<div class="ttc" id="acli_8h_html"><div class="ttname"><a href="cli_8h.html">cli.h</a></div></div>
<div class="ttc" id="agroup__aos__kernel__time_html_ga198267174bf34247bca2163293c20d5c"><div class="ttname"><a href="group__aos__kernel__time.html#ga198267174bf34247bca2163293c20d5c">aos_msleep</a></div><div class="ttdeci">void aos_msleep(uint32_t ms)</div></div>
<div class="ttc" id="agroup__init__aos__api_html_ga55ef20a4d055aed8a8b3b25a90f8aee4"><div class="ttname"><a href="group__init__aos__api.html#ga55ef20a4d055aed8a8b3b25a90f8aee4">application_start</a></div><div class="ttdeci">int application_start(int argc, char **argv)</div></div>
<div class="ttc" id="ainit_8h_html"><div class="ttname"><a href="init_8h.html">init.h</a></div></div>
<div class="ttc" id="akernel_8h_html"><div class="ttname"><a href="kernel_8h.html">kernel.h</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md397"></a>
步骤5 编译固件</h2>
<p>在示例代码已经添加至组件的配置文件，并且helloworld_demo已添加了对该组件的依赖后，就可以编译helloworld_demo案例来生成固件了，具体编译方法可参考<a href="https://g.alicdn.com/alios-things-3.3/doc/build_project.html">《aos-studio使用说明之编译固件》</a>。</p>
<h2><a class="anchor" id="autotoc_md398"></a>
步骤6 烧录固件</h2>
<p>helloworld_demo案例的固件生成后，可参考<a href="https://g.alicdn.com/alios-things-3.3/doc/build_image.html">《aos-studio使用说明之烧录固件》</a>来烧录固件。</p>
<h2><a class="anchor" id="autotoc_md399"></a>
步骤7 打开串口</h2>
<p>固件烧录完成后，可以通过串口查看示例的运行结果，打开串口的具体方法可参考<a href="_haa_s100__quick__start.html">《aos-studio使用说明之查看日志》</a>。</p>
<h2><a class="anchor" id="autotoc_md400"></a>
步骤8 测试示例</h2>
<p><b>CLI命令行输入：</b> </p><div class="fragment"><div class="line">help</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>可以看到注册的命令： </p>
</blockquote>
<div class="fragment"><div class="line">test</div>
<div class="line">test1</div>
<div class="line">test2</div>
<div class="line">test3</div>
</div><!-- fragment --><p> 执行不同的命令，有相应的日志输出</p>
<h1><a class="anchor" id="autotoc_md401"></a>
FAQ</h1>
<p>Q1： 如何打开文件系统操作命令集？ 答： cli组件支持文件系统操作命令，默认关闭，打开方式为： 以运行helloworld_demo为例，在其package.yaml中添加</p>
<div class="fragment"><div class="line">def_config:</div>
<div class="line">  CLI_IOBOX_ENABLE: 1</div>
</div><!-- fragment --><p>然后重新编译烧录，上电后输入help，即可看到 ls ll mkdir cat df touch ... 等文件系统命令</p>
<p>Q2：文件系统命令如何使用？ 答： cli组件支持文件系统操作命令，使用方法类似Linux常见shell命令，简单举例如下：</p>
<p>lsfs - 列出当前系统注册的文件系统节点 命令显示： /data 表示当前文件系统(littlefs)注册的节点为/data</p>
<p>df - 显示文件系统当前使用情况（单位：KB） 命名显示： Total Used Free Use% Mount 4792 2416 2376 50% /data 可以查看/data下文件的使用情况</p>
<p>mkdir - 创建文件夹 mkdir /data/123 ll /data （或者 ls -l /data） 命令显示： drwxrwxrwx root root 0B . drwxrwxrwx root root 0B .. drwxrwxrwx root root 0B aaa -rwxrwxrwx root root 21B demo drwxrwxrwx root root 0B font drwxrwxrwx root root 0B lib (注意：当前尚不支持可读/可写/可执行等权限设置)</p>
<p>touch - 创建单个文件 cd /data/aaa touch 123.txt ll 命令显示： drwxrwxrwx root root 0B . drwxrwxrwx root root 0B .. -rwxrwxrwx root root 0B 123.txt</p>
<p>pwd - 显示当前路径 命令显示： /data/aaa</p>
<p>echo</p><ol type="1">
<li>显示普通字符串: echo "hello,world!"</li>
<li>显示结果定向至文件 echo "alibaba" &gt; /data/aaa/123.txt cat /data/aaa/123.txt 命令显示： alibaba </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">生成于 2021年 四月 23日 星期五 11:08:20 , 为 物联网操作系统AliOS Things 3.3使用  <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
